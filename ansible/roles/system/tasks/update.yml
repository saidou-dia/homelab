---
# Mettre à jour tous les systèmes Debian/Ubuntu
- name: Mettre à jour le cache APT
  apt:
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: Mettre à jour tous les paquets installés
  apt:
    upgrade: dist
  when: ansible_os_family == "Debian"

- name: Autoremove les paquets inutilisés
  apt:
    autoremove: yes
  when: ansible_os_family == "Debian"

- name: Reboot si nécessaire après mise à jour
  reboot:
    msg: "Redémarrage automatique après mise à jour"
    pre_reboot_delay: 5
    post_reboot_delay: 30
  when: ansible_facts['pkg_mgr'] == 'apt'

- name: Installer unattended-upgrades pour mises à jour automatiques
  apt:
    name: unattended-upgrades
    state: present
  when: ansible_os_family == "Debian"

